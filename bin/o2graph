#!/usr/bin/env python
import sys
import ctypes
from ctypes.util import find_library
import platform
import os

o2scl_libdir=''
backend=''

for i in range(1,len(sys.argv)):
  if sys.argv[i]=='-o2scl-libdir':
    if i>=len(sys.argv)-1:
      print('Option -o2scl-libdir specified with no value.')
    else:
      o2scl_libdir=sys.argv[i+1]
      print('Set o2scl-libdir to',o2scl_libdir)
  elif sys.argv[i]=='-backend':
    if i>=len(sys.argv)-1:
      print('Option -backend specified with no value.')
    else:
      backend=sys.argv[i+1]
      print('Set backend to',backend)

if platform.system()=='Darwin':
    dir="/usr/local/lib/gcc/6/libstdc++.dylib"
    systcpp=ctypes.CDLL(dir,mode=ctypes.RTLD_GLOBAL)
    if o2scl_libdir=='':
      o2scl_libdir=os.getenv('O2SCL_LIB')
      if o2scl_libdir!='None':
        print('Set o2scl-libdir to',o2scl_libdir)
    # getenv reports 'None' if not found
    if o2scl_libdir!='None':
      o2scl=ctypes.CDLL(o2scl_libdir+'/libo2scl.dylib',
                        mode=ctypes.RTLD_GLOBAL)
    else:
      o2scl=ctypes.CDLL('libo2scl.dylib',mode=ctypes.RTLD_GLOBAL)
else:
    stdcpp=ctypes.CDLL(find_library("stdc++"),mode=ctypes.RTLD_GLOBAL)
    o2scl=ctypes.CDLL(find_library("o2scl"),mode=ctypes.RTLD_GLOBAL)

i=ctypes.c_int(2)
print(o2scl.o2scl_python_test(i))

if backend!='':
  import matplotlib
  matplotlib.use(backend)

import o2sclpy
gc=o2sclpy.plotter()
gc.parse_argv(sys.argv,o2scl)

